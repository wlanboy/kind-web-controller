<!DOCTYPE html>
<html data-theme="dark">
<head>
  <title>Kind Cluster Manager</title>
  <link rel="stylesheet" href="/static/style.css">
  <script src="https://unpkg.com/htmx.org@1.9.2"></script>
  <script>
    function toggleTheme() {
      const html = document.documentElement;
      html.dataset.theme = html.dataset.theme === "dark" ? "light" : "dark";
    }
    let currentStream = null;

    function startStream(task, name) {
      if (currentStream) {
        currentStream.close();
      }

      const url = `/stream?task=${task}&name=${name}`;
      const output = document.querySelector('#live-output code');
      output.textContent = ""; // clear previous output

      currentStream = new EventSource(url);
      console.log("[DEBUG] EventSource opened:", url);

      currentStream.onmessage = (event) => {
        if (event.data === "[STREAM CLOSED]") {
          console.log("[DEBUG] Stream finished cleanly.");
          currentStream.close();
          return;
        }
        output.textContent += event.data + "\n";
      };

      currentStream.onerror = (err) => {
        console.error("[SSE ERROR]", err);
        currentStream.close();
      };
    }

  function startStreamMetallb(name) {
    if (window.currentStream) {
      window.currentStream.close();
    }

    const output = document.querySelector('#live-output code');
    output.textContent = "";

    const url = `/streammetallb?name=${name}`;
    window.currentStream = new EventSource(url);
    console.log("[DEBUG] MetalLB stream opened:", url);

    window.currentStream.onmessage = (event) => {
      if (event.data === "[STREAM CLOSED]") {
        console.log("[DEBUG] Stream finished cleanly.");
        currentStream.close();
        return;
      }
      output.textContent += event.data + "\n";
    };

    window.currentStream.onerror = (err) => {
      console.warn("[SSE ERROR]", err);
      window.currentStream.close();
    };
  }
  </script>
</head>
<body>
  <header>
    <h1>Kind Cluster Manager</h1>
    <button class="btn blue" onclick="toggleTheme()">Toggle Theme</button>
  </header>
  {% block content %}{% endblock %}
</body>
</html>
